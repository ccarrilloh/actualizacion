<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glitched Box - Art Toys Coleccionables</title>
    <link rel="stylesheet" href="gb-core.css">
    <link rel="stylesheet" href="home.css">
</head>
<body>
  <!-- HEADER (de gb-core) -->
  <header class="header">
    <div class="layout__container">
      <div class="header-content">

        <!-- Hamburger Menu Toggle (mobile only) -->
        <button class="hamburger-toggle" id="hamburgerToggle" aria-label="Abrir menÃº de navegaciÃ³n" type="button">
          <span class="hamburger-icon" aria-hidden="true">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>

        <!-- Logo -->
        <div class="logo">
          <a aria-label="Glitched Box (inicio)" href="index.html">
            <img
              alt="Glitched Box"
              class="header-logo-img"
              data-logo-dark="images/logo_glitchedbox_horizontal.svg"
              data-logo-light="images/logo_glitchedbox_horizontal_black.svg"
              decoding="async"
              id="headerLogo"
              loading="eager"
              src="images/logo_glitchedbox_horizontal.svg"
            />
          </a>
        </div>

        <!-- NavegaciÃ³n Primaria -->
        <nav class="primary-nav" aria-label="NavegaciÃ³n principal">
          <button aria-label="Tienda" class="icon-button" type="button">
            <span aria-hidden="true" class="icon-wrap icon-wrap--24">
              <svg aria-hidden="true" fill="currentColor" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 3V1H18V3H2ZM2 19V10H1V7.5L2 2H18L19 7.5V10H18V19H15V10H10V19H2ZM4 17H8V12H4V17ZM3 8H17L16.5 4H3.5L3 8Z" fill="currentColor"></path>
              </svg>
            </span>
            <span>Tienda</span>
          </button>

          <button aria-label="Colecciones" class="icon-button" type="button">
            <span aria-hidden="true" class="icon-wrap icon-wrap--24">
              <svg aria-hidden="true" fill="currentColor" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 1H9V9H1V1ZM11 1H19V9H11V1ZM1 11H9V19H1V11ZM11 11H19V19H11V11Z" fill="currentColor"/>
              </svg>
            </span>
            <span>Colecciones</span>
          </button>
        </nav>
                
        <!-- Search Bar (desktop/tablet) -->
        <div class="header-search">
          <div class="search-container">
            <span aria-hidden="true" class="icon-wrap icon-wrap--24 search-icon">
              <svg aria-hidden="true" fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                <path d="M19 19L14.65 14.65" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
              </svg>
            </span>
            <input aria-label="Buscar productos" class="search-input" placeholder="Buscar productos..." type="text"/>
          </div>
        </div>

        <!-- Actions -->
        <div class="header-actions">

          <!-- Search (mobile) -->
          <button aria-label="Abrir bÃºsqueda" class="icon-button search-toggle" id="searchToggle" type="button">
            <span aria-hidden="true" class="icon-wrap icon-wrap--24">
              <svg aria-hidden="true" fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                <path d="M19 19L14.65 14.65" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
              </svg>
            </span>
            <span>Buscar</span>
          </button>
          
          <button aria-label="Iniciar sesiÃ³n" class="icon-button" type="button">
            <span aria-hidden="true" class="icon-wrap icon-wrap--24">
              <svg aria-hidden="true" fill="currentColor" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 10C12.7614 10 15 7.76142 15 5C15 2.23858 12.7614 0 10 0C7.23858 0 5 2.23858 5 5C5 7.76142 7.23858 10 10 10ZM10 12.5C6.66667 12.5 0 14.175 0 17.5V20H20V17.5C20 14.175 13.3333 12.5 10 12.5Z" fill="currentColor"></path>
              </svg>
            </span>
            <span>Iniciar sesiÃ³n</span>
          </button>

          <button aria-label="Favoritos" class="icon-button" type="button">
            <span aria-hidden="true" class="icon-wrap icon-wrap--24">
              <svg aria-hidden="true" fill="currentColor" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 18.35L8.55 17.03C3.4 12.36 0 9.27 0 5.5C0 2.41 2.42 0 5.5 0C7.24 0 8.91 0.81 10 2.08C11.09 0.81 12.76 0 14.5 0C17.58 0 20 2.41 20 5.5C20 9.27 16.6 12.36 11.45 17.03L10 18.35Z" fill="currentColor"></path>
              </svg>
            </span>
            <span>Favoritos</span>
          </button>

          <button aria-label="Carrito" class="icon-button cart-button" type="button">
            <span aria-hidden="true" class="icon-wrap icon-wrap--24">
              <svg aria-hidden="true" fill="currentColor" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 16C4.9 16 4.01 16.9 4.01 18C4.01 19.1 4.9 20 6 20C7.1 20 8 19.1 8 18C8 16.9 7.1 16 6 16ZM0 0V2H2L5.6 9.59L4.24 12.04C4.09 12.32 4 12.65 4 13C4 14.1 4.9 15 6 15H18V13H6.42C6.28 13 6.17 12.89 6.17 12.75L6.2 12.63L7.1 11H14.55C15.3 11 15.96 10.58 16.3 9.97L19.88 3.48C19.96 3.34 20 3.17 20 3C20 2.45 19.55 2 19 2H4.21L3.27 0H0ZM16 16C14.9 16 14.01 16.9 14.01 18C14.01 19.1 14.9 20 16 20C17.1 20 18 19.1 18 18C18 16.9 17.1 16 16 16Z" fill="currentColor"></path>
              </svg>
            </span>
            <span>Carrito</span>
            <span class="cart-badge" id="cartBadge">0</span>
          </button>

        </div>
      </div>
    </div>
  </header>

  <!-- BARRA SUPERIOR (Sin breadcrumbs, solo controles a la derecha) -->
  <div class="top-bar">
    <div class="layout__container">
      <div class="top-bar__content">
        <!-- Language Selector -->
        <div class="language-selector" id="languageSelector">
          <button class="language-toggle" id="languageToggle" aria-label="Cambiar idioma" type="button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M7 2a1 1 0 011 1v1h3a1 1 0 110 2H9.578a18.87 18.87 0 01-1.724 4.78c.29.354.596.696.914 1.026a1 1 0 11-1.44 1.389c-.188-.196-.373-.396-.554-.6a19.098 19.098 0 01-3.107 3.567 1 1 0 01-1.334-1.49 17.087 17.087 0 003.13-3.733 18.992 18.992 0 01-1.487-2.494 1 1 0 111.79-.89c.234.47.489.928.764 1.372.417-.934.752-1.913.997-2.927H3a1 1 0 110-2h3V3a1 1 0 011-1zm6 6a1 1 0 01.894.553l2.991 5.982a.869.869 0 01.02.037l.99 1.98a1 1 0 11-1.79.895L15.383 16h-4.764l-.724 1.447a1 1 0 11-1.788-.894l.99-1.98.019-.038 2.99-5.982A1 1 0 0113 8zm-1.382 6h2.764L13 11.236 11.618 14z" clip-rule="evenodd"/>
            </svg>
            <span id="currentLang">ES</span>
            <svg class="language-toggle-chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          </button>
          <div class="language-dropdown" role="menu">
            <button class="language-option active" data-lang="es" role="menuitem">
              ğŸ‡²ğŸ‡½ EspaÃ±ol
            </button>
            <button class="language-option" data-lang="en" role="menuitem">
              ğŸ‡ºğŸ‡¸ English
            </button>
          </div>
        </div>

        <!-- Theme Switch -->
        <label class="theme-switch" aria-label="Cambiar tema">
          <input id="themeToggle" type="checkbox" class="theme-switch__checkbox" data-theme-toggle aria-label="Cambiar tema claro/oscuro">
          <div class="theme-switch__container" aria-hidden="true">
            <div class="theme-switch__clouds"></div>
            <div class="theme-switch__stars-container">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 144 55" fill="none" aria-hidden="true">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M135.8 3c-.8.9-1.7 1.3-2.8 1.4 1.1.1 2 .5 2.8 1.4.8.9 1.2 1.9 1.2 3.1 0-.8.2-1.5.5-2.1.4-.7.9-1.2 1.5-1.6.6-.4 1.3-.6 2.1-.6-1.1-.1-2.1-.5-2.9-1.4C137.4 2.2 137 1.2 137 0c0 1.2-.4 2.2-1.2 3ZM31 23.4c1.1-.1 2-.5 2.8-1.4.8-.9 1.2-1.8 1.2-3 0 1.2.4 2.1 1.2 3 .8.9 1.7 1.3 2.8 1.4-.7 0-1.4.2-2 .6-.6.4-1.1.9-1.5 1.6-.4.7-.5 1.4-.5 2.1 0-1.2-.4-2.2-1.2-3.1-.8-.9-1.7-1.3-2.8-1.4Z" fill="currentColor"/>
              </svg>
            </div>
            <div class="theme-switch__circle-container">
              <div class="theme-switch__sun-moon-container">
                <div class="theme-switch__moon">
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                  <div class="theme-switch__spot"></div>
                </div>
              </div>
            </div>
          </div>
        </label>
      </div>
    </div>
  </div>

  <!-- Search Overlay (mobile) -->
  <div aria-hidden="true" class="search-overlay" id="searchOverlay">
    <div class="search-overlay__backdrop" data-search-close=""></div>
    <div aria-label="Buscar productos" aria-modal="true" class="search-overlay__panel" role="dialog">
      <div class="search-overlay__header">
        <strong class="search-overlay__title">Buscar</strong>
        <button aria-label="Cerrar bÃºsqueda" class="icon-button search-overlay__close" data-search-close="" type="button">
          <span aria-hidden="true" class="icon-wrap icon-wrap--20">
            <svg aria-hidden="true" fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M4 4L16 16" stroke="currentColor" stroke-linecap="round" stroke-width="2"></path>
              <path d="M16 4L4 16" stroke="currentColor" stroke-linecap="round" stroke-width="2"></path>
            </svg>
          </span>
        </button>
      </div>
      <div class="search-container">
        <span aria-hidden="true" class="icon-wrap icon-wrap--24 search-icon">
          <svg aria-hidden="true" fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
            <path d="M19 19L14.65 14.65" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
          </svg>
        </span>
        <input aria-label="Buscar productos" class="search-input" id="searchInputMobile" placeholder="Buscar productos..." type="text"/>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu" id="mobileMenu" aria-hidden="true">
    <div class="mobile-menu__backdrop" data-menu-close=""></div>
    
    <div class="mobile-menu__panel">
      <div class="mobile-menu__header">
        <span class="mobile-menu__title">MenÃº</span>
        <button class="mobile-menu__close" data-menu-close="" aria-label="Cerrar menÃº" type="button">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 4L16 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M16 4L4 16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <nav class="mobile-menu__nav" aria-label="NavegaciÃ³n mÃ³vil">
        
        <!-- 1. TIENDA -->
        <a href="tienda.html" class="mobile-menu__link">
          <span aria-hidden="true" class="icon-wrap icon-wrap--24">
            <svg aria-hidden="true" fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
              <path d="M2 3V1H18V3H2ZM2 19V10H1V7.5L2 2H18L19 7.5V10H18V19H15V10H10V19H2ZM4 17H8V12H4V17ZM3 8H17L16.5 4H3.5L3 8Z" fill="currentColor"/>
            </svg>
          </span>
          <span>Tienda</span>
        </a>

        <!-- 2. COLECCIONES -->
        <a href="colecciones.html" class="mobile-menu__link">
          <span aria-hidden="true" class="icon-wrap icon-wrap--24">
            <svg aria-hidden="true" fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
              <path d="M0 0H8V8H0V0ZM10 0H18V8H10V0ZM0 10H8V18H0V10ZM10 10H18V18H10V10ZM2 2V6H6V2H2ZM12 2V6H16V2H12ZM2 12V16H6V12H2ZM12 12V16H16V12H12Z" fill="currentColor"/>
            </svg>
          </span>
          <span>Colecciones</span>
        </a>

        <!-- 3. FAVORITOS -->
        <a href="favoritos.html" class="mobile-menu__link">
          <span aria-hidden="true" class="icon-wrap icon-wrap--24">
            <svg aria-hidden="true" fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 18.35L8.55 17.03C3.4 12.36 0 9.27 0 5.5C0 2.41 2.42 0 5.5 0C7.24 0 8.91 0.81 10 2.08C11.09 0.81 12.76 0 14.5 0C17.58 0 20 2.41 20 5.5C20 9.27 16.6 12.36 11.45 17.03L10 18.35Z" fill="currentColor"/>
            </svg>
          </span>
          <span>Favoritos</span>
        </a>

        <!-- 4. INICIAR SESIÃ“N / MI CUENTA -->
        <a href="login.html" class="mobile-menu__link">
          <span aria-hidden="true" class="icon-wrap icon-wrap--24">
            <svg aria-hidden="true" fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 10C12.7614 10 15 7.76142 15 5C15 2.23858 12.7614 0 10 0C7.23858 0 5 2.23858 5 5C5 7.76142 7.23858 10 10 10ZM10 12.5C6.66667 12.5 0 14.175 0 17.5V20H20V17.5C20 14.175 13.3333 12.5 10 12.5Z" fill="currentColor"/>
            </svg>
          </span>
          <span>Iniciar sesiÃ³n</span>
        </a>

        <!-- SEPARADOR -->
        <div class="mobile-menu__separator"></div>

        <!-- 5. IDIOMA -->
        <button class="mobile-menu__link" id="mobileLangToggle" type="button">
          <span aria-hidden="true" class="icon-wrap icon-wrap--24">
            <svg aria-hidden="true" fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM17 10C17 10.58 16.95 11.14 16.85 11.69L14 10.5V9.5C14 8.67 13.33 8 12.5 8H11V6C11 5.45 10.55 5 10 5H8V3H10C10.55 3 11 2.55 11 2V1.14C14.41 1.67 17 4.53 17 8V10ZM3 10C3 7.81 3.96 5.87 5.46 4.54L7 6.08V7C7 8.1 7.9 9 9 9V11.08C6.39 11.56 4.34 13.65 4 16.28C3.36 14.99 3 13.55 3 12V10Z" fill="currentColor"/>
            </svg>
          </span>
          <span>Idioma: <span id="mobileLangDisplay">EspaÃ±ol</span></span>
        </button>

        <!-- 6. TEMA -->
        <button class="mobile-menu__link mobile-menu__link--theme" id="mobileThemeToggle" type="button">
          <span aria-hidden="true" class="icon-wrap icon-wrap--24">
            <svg aria-hidden="true" fill="currentColor" height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg" id="mobileThemeIcon">
              <path class="theme-icon-moon" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="currentColor"/>
            </svg>
          </span>
          <span>Tema: <span id="mobileThemeDisplay">Oscuro</span></span>
        </button>

      </nav>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <div class="layout__container">

      <!-- HERO SECTION -->
      <section class="hero">
        <div class="hero__frame">
          <img src="images/hero_image_bg.webp" alt="" class="hero__bg hero__bg--dark" />
          <img src="images/hero_image_light.webp" alt="" class="hero__bg hero__bg--light" />
          <img src="images/hero_image_character.webp" alt="Kitsune Guardian" class="hero__character" />
          
          <div class="hero__content">
            <h1 class="hero__title">Descubre la colecciÃ³n completa</h1>
            <p class="hero__description">
              El Kitsune se ha fragmentado en tres formas: Rojo, Azul y Morado. Cada uno con su propia energÃ­a... y su propia historia. Explora la colecciÃ³n completa y elige tu Kitsune.
            </p>
            <div class="hero__actions">
              <a href="colecciones.html" class="btn btn--primary">
                Ver colecciÃ³n
              </a>
              <button class="btn btn--ghost">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 16C4.9 16 4.01 16.9 4.01 18C4.01 19.1 4.9 20 6 20C7.1 20 8 19.1 8 18C8 16.9 7.1 16 6 16ZM0 0V2H2L5.6 9.59L4.24 12.04C4.09 12.32 4 12.65 4 13C4 14.1 4.9 15 6 15H18V13H6.42C6.28 13 6.17 12.89 6.17 12.75L6.2 12.63L7.1 11H14.55C15.3 11 15.96 10.58 16.3 9.97L19.88 3.48C19.96 3.34 20 3.17 20 3C20 2.45 19.55 2 19 2H4.21L3.27 0H0ZM16 16C14.9 16 14.01 16.9 14.01 18C14.01 19.1 14.9 20 16 20C17.1 20 18 19.1 18 18C18 16.9 17.1 16 16 16Z" fill="currentColor"/>
                </svg>
                Agregar al carrito
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- PRODUCTOS DESTACADOS -->
      <section class="section">
        <div class="section__head section__head--left animate-on-scroll">
          <h2 class="section__title">Echa un vistazo a otras colecciones</h2>
          <p class="section__desc">
            Descubre nuevas criaturas que no pueden faltar en tu colecciÃ³n, cada una con su propio estilo y misterio.
          </p>
        </div>

        <div class="products-grid">
          <!-- Producto 1 -->
          <article class="product-card animate-on-scroll">
            <a href="#" class="product-card__media">
              <img src="images/kitsune_fantasma_card.webp" alt="Kitsune Fantasma" />
            </a>
            <div class="product-card__body">
              <h3 class="product-card__title">Kitsune</h3>
              <div class="product-card__price-section">
                <span class="product-card__price">$450 MXN</span>
                <p class="product-card__availability">Disponible en varios colores</p>
              </div>
              <button class="btn btn--sm btn--full">
                <span class="btn__text glitch-text" data-text="Ver mÃ¡s">Ver mÃ¡s</span>
              </button>
            </div>
          </article>

          <!-- Producto 2 -->
          <article class="product-card animate-on-scroll">
            <a href="#" class="product-card__media">
              <img src="images/nahual_card.webp" alt="Nahual" />
            </a>
            <div class="product-card__body">
              <h3 class="product-card__title">Nahual</h3>
              <div class="product-card__price-section">
                <span class="product-card__price">$900 MXN</span>
                <p class="product-card__availability">EdiciÃ³n Ãºnica</p>
              </div>
              <button class="btn btn--sm btn--full">
                <span class="btn__text glitch-text" data-text="Ver mÃ¡s">Ver mÃ¡s</span>
              </button>
            </div>
          </article>

          <!-- Producto 3 -->
          <article class="product-card animate-on-scroll">
            <a href="#" class="product-card__media">
              <img src="images/arco_torii_rojo_card.webp" alt="Arco Torii Rojo" />
            </a>
            <div class="product-card__body">
              <h3 class="product-card__title">Arco Torii</h3>
              <div class="product-card__price-section">
                <span class="product-card__price">$650 MXN</span>
                <p class="product-card__availability">Disponible en varios colores</p>
              </div>
              <button class="btn btn--sm btn--full">
                <span class="btn__text glitch-text" data-text="Ver mÃ¡s">Ver mÃ¡s</span>
              </button>
            </div>
          </article>

          <!-- Producto 4 -->
          <article class="product-card animate-on-scroll">
            <a href="#" class="product-card__media">
              <img src="images/dr_plaga_card.webp" alt="Dr. Plaga" />
            </a>
            <div class="product-card__body">
              <h3 class="product-card__title">Doctor Plaga</h3>
              <div class="product-card__price-section">
                <span class="product-card__price">$950 MXN</span>
                <p class="product-card__availability">EdiciÃ³n Ãºnica</p>
              </div>
              <button class="btn btn--sm btn--full">
                <span class="btn__text glitch-text" data-text="Ver mÃ¡s">Ver mÃ¡s</span>
              </button>
            </div>
          </article>

          <!-- Producto 5 -->
          <article class="product-card animate-on-scroll">
            <a href="#" class="product-card__media">
              <img src="images/hamster_card.webp" alt="Hamster" />
            </a>
            <div class="product-card__body">
              <h3 class="product-card__title">Hamster</h3>
              <div class="product-card__price-section">
                <span class="product-card__price">$950 MXN</span>
                <p class="product-card__availability">EdiciÃ³n Ãºnica</p>
              </div>
              <button class="btn btn--sm btn--full">
                <span class="btn__text glitch-text" data-text="Ver mÃ¡s">Ver mÃ¡s</span>
              </button>
            </div>
          </article>

          <!-- Producto 6 -->
          <article class="product-card animate-on-scroll">
            <a href="#" class="product-card__media">
              <img src="images/jackalope_amarillo_card.webp" alt="Jackalope" />
            </a>
            <div class="product-card__body">
              <h3 class="product-card__title">Jackalope</h3>
              <div class="product-card__price-section">
                <span class="product-card__price">$800 MXN</span>
                <p class="product-card__availability">Disponible en varios colores</p>
              </div>
              <button class="btn btn--sm btn--full">
                <span class="btn__text glitch-text" data-text="Ver mÃ¡s">Ver mÃ¡s</span>
              </button>
            </div>
          </article>

          <!-- Producto 7 -->
          <article class="product-card animate-on-scroll">
            <a href="#" class="product-card__media">
              <img src="images/gallinitas_mÃ¡gicas_blanco_card.webp" alt="Gallinita MÃ¡gica" />
            </a>
            <div class="product-card__body">
              <h3 class="product-card__title">Gallinitas MÃ¡gicas</h3>
              <div class="product-card__price-section">
                <span class="product-card__price">$150 MXN</span>
                <p class="product-card__availability">Disponible en varios colores</p>
              </div>
              <button class="btn btn--sm btn--full">
                <span class="btn__text glitch-text" data-text="Ver mÃ¡s">Ver mÃ¡s</span>
              </button>
            </div>
          </article>

          <!-- Producto 8 -->
          <article class="product-card animate-on-scroll">
            <a href="#" class="product-card__media">
              <img src="images/reaper_halloween_card_300x300.webp" alt="Reaper" />
            </a>
            <div class="product-card__body">
              <h3 class="product-card__title">Reaper</h3>
              <div class="product-card__price-section">
                <span class="product-card__price">$1,200 MXN</span>
                <p class="product-card__availability">Disponible en varios colores</p>
              </div>
              <button class="btn btn--sm btn--full">
                <span class="btn__text glitch-text" data-text="Ver mÃ¡s">Ver mÃ¡s</span>
              </button>
            </div>
          </article>
        </div>
      </section>

      <!-- BENEFITS / FEATURES -->
      <section class="section section--muted">
        <div class="section__head animate-on-scroll">
          <h2 class="section__title">EnvÃ­o y pago sin complicaciones</h2>
          <p class="section__desc">
            Desde que eliges tu Art Toy hasta que lo recibes, nos encargamos de que todo sea seguro, rÃ¡pido y emocionante.
          </p>
        </div>

        <div class="benefits">
          <!-- Benefit 1: Empaque seguro -->
          <div class="benefit animate-on-scroll">
            <svg class="benefit__icon" viewBox="0 0 32 34" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M30.72 7.61111L17.1815 0.300713C16.8198 0.103465 16.4133 0 16 0C15.5867 0 15.1802 0.103465 14.8185 0.300713L1.28 7.61415C0.893367 7.82291 0.570621 8.13029 0.345464 8.50419C0.120308 8.87808 0.0010004 9.30477 0 9.7397V24.2603C0.0010004 24.6952 0.120308 25.1219 0.345464 25.4958C0.570621 25.8697 0.893367 26.1771 1.28 26.3859L14.8185 33.6993C15.1802 33.8965 15.5867 34 16 34C16.4133 34 16.8198 33.8965 17.1815 33.6993L30.72 26.3859C31.1066 26.1771 31.4294 25.8697 31.6545 25.4958C31.8797 25.1219 31.999 24.6952 32 24.2603V9.74122C31.9998 9.30552 31.8809 8.87787 31.6557 8.50311C31.4305 8.12834 31.1073 7.82025 30.72 7.61111ZM16 2.42627L28.3615 9.10659L23.78 11.5798L11.4185 4.89951L16 2.42627ZM16 15.7869L3.63846 9.10659L8.85538 6.28719L21.2169 12.9675L16 15.7869ZM29.5385 24.2664L17.2308 30.9148V17.8867L22.1538 15.2282V20.6453C22.1538 20.9675 22.2835 21.2764 22.5143 21.5042C22.7451 21.732 23.0582 21.8599 23.3846 21.8599C23.711 21.8599 24.0241 21.732 24.2549 21.5042C24.4857 21.2764 24.6154 20.9675 24.6154 20.6453V13.8982L29.5385 11.2397V24.2603V24.2664Z" fill="currentColor"/>
            </svg>
            <h3 class="benefit__title">Empaque seguro</h3>
            <p class="benefit__desc">
              Tus art toys viajan protegidos en cajas diseÃ±adas con estilo.
            </p>
          </div>

          <!-- Benefit 2: EnvÃ­o a todo MÃ©xico -->
          <div class="benefit animate-on-scroll">
            <svg class="benefit__icon" viewBox="0 0 36 27" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8.18182 27C6.81818 27 5.65909 26.5078 4.70455 25.5234C3.75 24.5391 3.27273 23.3437 3.27273 21.9375H1.63636C1.17273 21.9375 0.784364 21.7755 0.471273 21.4515C0.158182 21.1275 0.00109091 20.727 0 20.25V3.375C0 2.44687 0.320727 1.65262 0.962182 0.99225C1.60364 0.331875 2.37382 0.001125 3.27273 0H22.9091C23.8091 0 24.5798 0.33075 25.2213 0.99225C25.8627 1.65375 26.1829 2.448 26.1818 3.375V6.75H29.4545C29.9727 6.75 30.4636 6.86981 30.9273 7.10944C31.3909 7.34906 31.7727 7.67925 32.0727 8.1L35.6727 13.0359C35.7818 13.1766 35.8636 13.3312 35.9182 13.5C35.9727 13.6688 36 13.8516 36 14.0484V20.25C36 20.7281 35.8429 21.1292 35.5287 21.4532C35.2145 21.7772 34.8262 21.9386 34.3636 21.9375H32.7273C32.7273 23.3437 32.25 24.5391 31.2955 25.5234C30.3409 26.5078 29.1818 27 27.8182 27C26.4545 27 25.2955 26.5078 24.3409 25.5234C23.3864 24.5391 22.9091 23.3437 22.9091 21.9375H13.0909C13.0909 23.3437 12.6136 24.5391 11.6591 25.5234C10.7045 26.5078 9.54545 27 8.18182 27ZM8.18182 23.625C8.64545 23.625 9.03436 23.463 9.34855 23.139C9.66273 22.815 9.81927 22.4145 9.81818 21.9375C9.81709 21.4605 9.66 21.06 9.34691 20.736C9.03382 20.412 8.64545 20.25 8.18182 20.25C7.71818 20.25 7.32982 20.412 7.01673 20.736C6.70364 21.06 6.54655 21.4605 6.54545 21.9375C6.54436 22.4145 6.70145 22.8156 7.01673 23.1407C7.332 23.4658 7.72036 23.6272 8.18182 23.625ZM27.8182 23.625C28.2818 23.625 28.6707 23.463 28.9849 23.139C29.2991 22.815 29.4556 22.4145 29.4545 21.9375C29.4535 21.4605 29.2964 21.06 28.9833 20.736C28.6702 20.412 28.2818 20.25 27.8182 20.25C27.3545 20.25 26.9662 20.412 26.6531 20.736C26.34 21.06 26.1829 21.4605 26.1818 21.9375C26.1807 22.4145 26.3378 22.8156 26.6531 23.1407C26.9684 23.4658 27.3567 23.6272 27.8182 23.625ZM26.1818 15.1875H33.1364L29.4545 10.125H26.1818V15.1875Z" fill="currentColor"/>
            </svg>
            <h3 class="benefit__title">EnvÃ­o a todo MÃ©xico</h3>
            <p class="benefit__desc">
              Usamos transportistas confiables.
            </p>
          </div>

          <!-- Benefit 3: Rastrea tu pedido -->
          <div class="benefit animate-on-scroll">
            <svg class="benefit__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="currentColor"/>
            </svg>
            <h3 class="benefit__title">Rastrea tu pedido</h3>
            <p class="benefit__desc">
              Recibe tu guÃ­a en cuanto tu pedido sale.
            </p>
          </div>

          <!-- Benefit 4: Pago seguro -->
          <div class="benefit animate-on-scroll">
            <svg class="benefit__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 1L3 5V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V5L12 1ZM12 11.99H19C18.47 16.11 15.72 19.78 12 20.93V12H5V6.3L12 3.19V11.99Z" fill="currentColor"/>
            </svg>
            <h3 class="benefit__title">Pago 100% Seguro</h3>
            <p class="benefit__desc">
              Aceptamos tarjetas, tu informaciÃ³n estÃ¡ segura.
            </p>
          </div>
        </div>
      </section>

      <!-- FAQ -->
      <section class="section">
        <div class="section__head animate-on-scroll">
          <h2 class="section__title">Preguntas Frecuentes</h2>
          <p class="section__desc">
            Todo lo que necesitas saber sobre nuestros art toys
          </p>
        </div>

        <div class="faq animate-on-scroll" data-faq>
          <button class="faq__item" aria-expanded="false">
            <span class="faq__q">Â¿QuÃ© es un art toy?</span>
            <span class="faq__icon">+</span>
          </button>
          <div class="faq__panel">
            <p>
              Los art toys son figuras de colecciÃ³n que combinan arte y diseÃ±o. No son simples juguetes: cada pieza es una obra con personalidad, historia y estilo propio.
            </p>
          </div>

          <button class="faq__item" aria-expanded="false">
            <span class="faq__q">Â¿De quÃ© estÃ¡n hechos los art toys de Glitched Box?</span>
            <span class="faq__icon">+</span>
          </button>
          <div class="faq__panel">
            <p>
              Nuestros art toys estÃ¡n hechos principalmente de resina de alta calidad y algunos incorporan detalles pintados a mano. Cada figura estÃ¡ cuidada hasta el Ãºltimo pixel para garantizar que luzca increÃ­ble tanto en vitrina como en tu feed.
            </p>
          </div>

          <button class="faq__item" aria-expanded="false">
            <span class="faq__q">Â¿QuÃ© mÃ©todos de pago aceptan?</span>
            <span class="faq__icon">+</span>
          </button>
          <div class="faq__panel">
            <p>
              Aceptamos tarjetas de crÃ©dito, dÃ©bito y pagos a travÃ©s de plataformas seguras como PayPal y MercadoPago.
            </p>
          </div>

          <button class="faq__item" aria-expanded="false">
            <span class="faq__q">Â¿Hacen envÃ­os internacionales?</span>
            <span class="faq__icon">+</span>
          </button>
          <div class="faq__panel">
            <p>
              Por ahora solo realizamos envÃ­os dentro de MÃ©xico. Esperamos poder llevar Glitched Box mÃ¡s allÃ¡ muy pronto, pero por el momento estamos enfocados en crecer dentro del paÃ­s.
            </p>
          </div>

          <button class="faq__item" aria-expanded="false">
            <span class="faq__q">Â¿CuÃ¡nto tarda en llegar mi pedido?</span>
            <span class="faq__icon">+</span>
          </button>
          <div class="faq__panel">
            <p>
              El tiempo de entrega dentro de MÃ©xico es de aproximadamente 3 a 7 dÃ­as hÃ¡biles. Una vez enviado, te compartiremos un nÃºmero de rastreo para que sigas el camino de tu figura.
            </p>
          </div>

          <button class="faq__item" aria-expanded="false">
            <span class="faq__q">Â¿Puedo devolver o cambiar mi pedido?</span>
            <span class="faq__icon">+</span>
          </button>
          <div class="faq__panel">
            <p>
              Por ahora solo realizamos envÃ­os dentro de MÃ©xico. Esperamos poder llevar Glitched Box mÃ¡s allÃ¡ muy pronto, pero por el momento estamos enfocados en crecer dentro del paÃ­s.
            </p>
          </div>

          <button class="faq__item" aria-expanded="false">
            <span class="faq__q">Â¿Puedo devolver o cambiar mi pedido?</span>
            <span class="faq__icon">+</span>
          </button>
          <div class="faq__panel">
            <p>
              Â¡SÃ­! Algunas son parte de una serie limitada, otras estÃ¡n pintadas a mano o tienen detalles Ãºnicos. Nos gusta que cada pieza tenga ese algo especial que la haga irrepetible.
            </p>
          </div>

          <button class="faq__item" aria-expanded="false">
            <span class="faq__q">Â¿Puedo encargar un art toy personalizado?</span>
            <span class="faq__icon">+</span>
          </button>
          <div class="faq__panel">
            <p>
              No por ahora, pero quiÃ©n sabe... si un dÃ­a abrimos esa opciÃ³n, lo anunciaremos a lo grande.
            </p>
          </div>
        </div>
      </section>

    </div>
  </main>

  <footer class="footer">

    <!-- Newsletter (centrado tipo container) -->
    <section class="newsletter">
      <div class="footer-container">
        <div class="newsletter-content">
          <div class="newsletter-left">
            <h2 class="newsletter-title">SuscrÃ­bete a nuestro boletÃ­n</h2>
            <p class="newsletter-description">
              EntÃ©rate antes que nadie de nuestras novedades, promos exclusivas y todo lo que estÃ¡ por venir.
            </p>
          </div>

          <form class="newsletter-form">
            <input type="email" class="newsletter-input" placeholder="Escribe tu correo electrÃ³nico" required>
            <button type="submit" class="newsletter-button">Suscribirse</button>
          </form>
          <p class="newsletter-help" aria-live="polite"></p>
        </div>
      </div>
    </section>

    <!-- Separador FULL WIDTH -->
    <div class="footer-separator"></div>

    <!-- Footer Content FULL WIDTH -->
    <div class="footer-content footer-content--full">
      <div class="footer-section">
        <div class="footer-logo">
          <img
            src="images/logo_glitchedbox_horizontal.svg"
            alt="Glitched Box"
            loading="lazy"
            decoding="async"
            class="footer-logo-img footer-logo--dark"
          >
          <img
            src="images/logo_glitchedbox_horizontal_black.svg"
            alt="Glitched Box"
            loading="lazy"
            decoding="async"
            class="footer-logo-img footer-logo--light"
          >
        </div>

        <p class="footer-description">
          Glitched Box es una marca mexicana de art toys inspirada en ilustraciones originales. Cada figura representa un personaje que llegÃ³ a nuestro mundo por error a travÃ©s de un "glitch". El estilo mezcla lo kawaii con lo oscuro, creando una estÃ©tica Ãºnica y coleccionable.
        </p>

        <div class="footer-social">
          <a href="" class="social-link" aria-label="Facebook">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M24 12.073C24 5.405 18.627 0 12 0S0 5.405 0 12.073C0 18.1 4.388 23.094 10.125 24v-8.437H7.078v-3.49h3.047v-2.66c0-3.025 1.792-4.697 4.533-4.697 1.312 0 2.686.235 2.686.235v2.971h-1.513c-1.491 0-1.956.93-1.956 1.886v2.265h3.328l-.532 3.49h-2.796V24C19.612 23.094 24 18.1 24 12.073z"/>
            </svg>
          </a>

          <a href="https://www.instagram.com/glitchedbox/" class="social-link" aria-label="Instagram">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/>
            </svg>
          </a>
        </div>
      </div>

      <div class="footer-section">
        <h3 class="footer-heading">QuiÃ©nes somos</h3>
        <ul class="footer-links">
          <li><a href="#">Nuestra historia</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3 class="footer-heading">Ayuda</h3>
        <ul class="footer-links">
          <li><a href="#">Seguimiento de pedido</a></li>
          <li><a href="#">EnvÃ­os y devoluciones</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3 class="footer-heading">Legal</h3>
        <ul class="footer-links">
          <li><a href="#">TÃ©rminos y condiciones</a></li>
          <li><a href="#">PolÃ­tica de privacidad</a></li>
          <li><a href="#">PolÃ­tica de envÃ­o</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3 class="footer-heading">Contacto</h3>
        <button class="contact-button">ContÃ¡ctanos</button>
      </div>
    </div>

    <!-- Footer bottom FULL WIDTH -->
    <div class="footer-bottom">
      <p>Â© 2019 - 2025 Glitched Box. Todos los derechos reservados. InformaciÃ³n exclusiva de Glitched Box</p>
    </div>

  </footer>

  <!-- Back to Top Button -->
  <button class="back-to-top" id="backToTop" aria-label="Volver arriba">
    <span class="icon-wrap icon-wrap--24" aria-hidden="true">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M12 4L4 12L5.41 13.41L11 7.83V20H13V7.83L18.59 13.41L20 12L12 4Z" fill="currentColor"/>
      </svg>
    </span>
  </button>

<script src="gb-core.js"></script>
<script src="home.js" defer></script>
<!-- =================================================
     GLITCHEDBOX CHATBOT WIDGET â€” v3 final
     Pega todo antes del </body>.
     Cambia src de la imagen en DOS lugares:
     1. FAB lateral: id='gb-fab-img'
     2. Header chat: id='gb-header-char'
     Ambos usan: assets/img/glitch-bot.webp
================================================= -->

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES â€” EstÃ©tica claude.ai + GlitchedBox
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --gb-bg:           #050505;
  --gb-surface:      #0c0c0c;
  --gb-surface2:     #111111;
  --gb-border:       rgba(255,255,255,.08);
  --gb-text:         #ede8df;
  --gb-text-dim:     #484440;
  --gb-text-mid:     #807870;
  --gb-accent:       #c8f000;
  --gb-accent-dark:  #a0c000;
  --gb-accent-rgb:   200, 240, 0;
  --gb-accent2:      #ff5c6a;
  --gb-accent2-rgb:  255, 92, 106;
  --gb-bubble-user:  rgba(200,240,0,.08);
  --gb-bubble-user-border: rgba(200,240,0,.15);
  --gb-shadow:       0 0 0 1px rgba(255,255,255,.05),
                     0 4px 24px rgba(0,0,0,.5),
                     0 24px 64px rgba(0,0,0,.7),
                     0 0 80px rgba(200,240,0,.03);
  --gb-glow:         0 0 12px rgba(200,240,0,.3);
  --gb-glow2:        0 0 12px rgba(255,92,106,.3);
  --gb-radius:       16px;
}

.gb-light,
[data-theme="light"] #gb-widget,
.light #gb-widget,
.light-theme #gb-widget {
  --gb-bg:           #f8f6f2;
  --gb-surface:      #ffffff;
  --gb-surface2:     #f2efe9;
  --gb-border:       rgba(0,0,0,.07);
  --gb-text:         #1a1714;
  --gb-text-dim:     #c0b8b0;
  --gb-text-mid:     #807870;
  --gb-accent:       #5a8500;
  --gb-accent-dark:  #3d6000;
  --gb-accent-rgb:   90, 133, 0;
  --gb-accent2:      #d93040;
  --gb-accent2-rgb:  217, 48, 64;
  --gb-bubble-user:  rgba(90,133,0,.07);
  --gb-bubble-user-border: rgba(90,133,0,.14);
  --gb-shadow:       0 0 0 1px rgba(0,0,0,.05),
                     0 4px 24px rgba(0,0,0,.06),
                     0 24px 64px rgba(0,0,0,.1);
  --gb-glow:         0 0 12px rgba(90,133,0,.2);
}

   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#gb-widget *,
#gb-widget *::before,
#gb-widget *::after {
  box-sizing: border-box;
  margin: 0; padding: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FAB â€” BotÃ³n lateral estilo Telcel
   Pegado a la derecha, a media pantalla.
   Al hover se expande mostrando texto.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Contenedor externo â€” fijo en pantalla */
#gb-fab-wrap {
  position: fixed;
  right: 0;
  top: 50%;
  transform: translateY(-60%);
  z-index: 9998;
  display: flex;
  align-items: center;
  /* TransiciÃ³n de entrada/salida */
  transition: opacity .25s cubic-bezier(.16,1,.3,1),
              transform .3s cubic-bezier(.16,1,.3,1);
  opacity: 1;
  pointer-events: all;
}

/* Cuando el chat estÃ¡ abierto â€” el botÃ³n desaparece */
#gb-fab-wrap.hidden {
  opacity: 0;
  pointer-events: none;
  transform: translateY(-60%) translateX(80px); /* se va hacia la derecha */
}

/* Pill expandible */
#gb-fab {
  position: relative;
  display: flex;
  align-items: center;
  gap: 0;
  background: var(--gb-accent);
  border: none;
  border-radius: 12px 0 0 12px; /* esquinas izquierda redondeadas, derecha pegada al borde */
  cursor: pointer;
  padding: 10px 10px;
  box-shadow: -4px 0 20px rgba(var(--gb-accent-rgb), .35), -2px 0 40px rgba(0,0,0,.4);
  overflow: hidden;
  /* ancho base: solo la imagen */
  width: 64px;
  height: auto;
  min-height: 72px;
  transition: width .35s cubic-bezier(.34,1.1,.64,1), box-shadow .25s, padding .35s;
  white-space: nowrap;
  font-size: 0;
}

#gb-fab:hover,
#gb-fab.open {
  width: 178px;
  padding: 10px 14px;
  box-shadow: -6px 0 28px rgba(var(--gb-accent-rgb), .55), -2px 0 50px rgba(0,0,0,.4);
}

/* Imagen del personaje */
#gb-fab-img {
  width: 44px;
  height: 44px;
  object-fit: contain;
  flex-shrink: 0;
  /* PequeÃ±o efecto de entrada */
  transition: transform .3s cubic-bezier(.34,1.56,.64,1);
  display: block;
}

/* Estado cerrado: Ã­cono de chat SVG (visible cuando no hay imagen) */
#gb-fab-icon {
  width: 28px; height: 28px;
  fill: #0e0e0e;
  flex-shrink: 0;
  display: none; /* se muestra solo si no hay imagen */
}

#gb-fab:hover #gb-fab-img,
#gb-fab.open #gb-fab-img {
  transform: scale(1.08);
}

/* Texto que aparece al hover */
#gb-fab-label {
  font-family: 'Rajdhani', system-ui, sans-serif;
  font-size: 13px;
  font-weight: 700;
  letter-spacing: .4px;
  color: #0e0e0e;
  opacity: 0;
  max-width: 0;
  overflow: hidden;
  transition: opacity .2s .1s, max-width .3s;
  text-align: left;
  line-height: 1.3;
  padding-left: 0;
}

#gb-fab:hover #gb-fab-label,
#gb-fab.open #gb-fab-label {
  opacity: 1;
  max-width: 120px;
  padding-left: 10px;
}

/* Ãcono cerrar â€” reemplaza la imagen cuando estÃ¡ abierto */
#gb-fab-close {
  width: 22px; height: 22px;
  fill: #0e0e0e;
  flex-shrink: 0;
  display: none;
  position: absolute;
  top: 8px; right: 8px;
}

#gb-fab.open #gb-fab-close {
  display: block;
}

#gb-fab.open #gb-fab-img {
  opacity: 0.5;
}

/* Badge notificaciÃ³n */
#gb-badge {
  position: absolute;
  top: 6px; left: 6px;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--gb-accent2);
  border: 2px solid var(--gb-accent);
  display: flex; align-items: center; justify-content: center;
  font-family: 'Rajdhani', system-ui, sans-serif;
  font-size: 10px; font-weight: 700;
  color: #fff;
  transition: transform .3s, opacity .3s;
  pointer-events: none;
}

#gb-badge.hidden {
  transform: scale(0);
  opacity: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIDGET PRINCIPAL â€” estilo claude.ai
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#gb-widget {
  position: fixed;
  top: 50%;
  right: 72px;
  transform: translateY(-50%) translateX(16px) scale(.96);
  width: 380px;
  height: 600px;
  max-height: calc(100vh - 60px);
  display: flex;
  flex-direction: column;
  background: var(--gb-surface);
  border: 1px solid var(--gb-border);
  border-radius: var(--gb-radius);
  overflow: hidden;
  box-shadow: var(--gb-shadow);
  z-index: 9997;
  font-family: 'DM Sans', 'Exo 2', system-ui, sans-serif;
  color: var(--gb-text);
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s cubic-bezier(.16,1,.3,1),
              transform .3s cubic-bezier(.16,1,.3,1);
}

#gb-widget.open {
  opacity: 1;
  pointer-events: all;
  transform: translateY(-50%) translateX(0) scale(1);
}

/* Borde con glow sutil al estar abierto */
#gb-widget.open {
  border-color: rgba(255,255,255,.1);
}

/* â”€â”€ Header â€” personaje centrado estilo claude.ai â”€â”€ */
#gb-header {
  background: linear-gradient(180deg, #0e1200 0%, var(--gb-surface2) 100%);
  border-bottom: 1px solid var(--gb-border);
  padding: 20px 16px 18px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
  flex-shrink: 0;
  position: relative;
  overflow: hidden;
}

/* Glow ambiental detrÃ¡s del personaje */
#gb-header::before {
  content: '';
  position: absolute;
  top: -20px; left: 50%;
  transform: translateX(-50%);
  width: 160px; height: 160px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(200,240,0,.12) 0%, transparent 70%);
  pointer-events: none;
}

/* Fila de botones arriba (reset + cerrar) */
#gb-header-actions {
  position: absolute;
  top: 10px; right: 10px;
  display: flex;
  gap: 4px;
}

/* Personaje â€” imagen grande centrada */
#gb-header-char {
  width: 90px;
  height: 90px;
  object-fit: contain;
  object-position: bottom;
  filter: drop-shadow(0 4px 20px rgba(200,240,0,.25));
  margin-bottom: 10px;
  animation: gb-float 4s ease-in-out infinite;
}

/* Fallback emoji si no carga el webp */
#gb-header-char-fallback {
  width: 90px; height: 90px;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 52px;
  margin-bottom: 10px;
  filter: drop-shadow(0 4px 20px rgba(200,240,0,.2));
}

@keyframes gb-float {
  0%, 100% { transform: translateY(0px); }
  50%       { transform: translateY(-5px); }
}

/* Info de nombre y estado â€” debajo del personaje */
.gb-header-info {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.gb-header-name {
  font-size: 14px;
  font-weight: 600;
  letter-spacing: .2px;
  color: var(--gb-text);
  display: flex;
  align-items: center;
  gap: 6px;
}

.gb-header-name span { color: var(--gb-accent); }

.gb-status-row {
  display: flex;
  align-items: center;
  gap: 5px;
}

.gb-status-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--gb-accent);
  box-shadow: 0 0 5px rgba(200,240,0,.9);
  animation: gb-pulse 2.5s ease-in-out infinite;
  flex-shrink: 0;
}

@keyframes gb-pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50%       { opacity: .3; transform: scale(.7); }
}

.gb-header-sub {
  font-size: 10px;
  color: var(--gb-text-dim);
  letter-spacing: .4px;
}

.gb-hbtn {
  width: 28px; height: 28px;
  border-radius: 8px;
  border: 1px solid transparent;
  background: transparent;
  color: var(--gb-text-dim);
  cursor: pointer;
  font-size: 13px;
  display: flex; align-items: center; justify-content: center;
  transition: all .15s;
  flex-shrink: 0;
}
.gb-hbtn:hover {
  background: rgba(255,255,255,.06);
  border-color: var(--gb-border);
  color: var(--gb-text);
}

/* â”€â”€ Ãrea de mensajes â”€â”€ */
#gb-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px 16px 12px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  scroll-behavior: smooth;
  background: var(--gb-bg);
}

#gb-messages::-webkit-scrollbar { width: 3px; }
#gb-messages::-webkit-scrollbar-track { background: transparent; }
#gb-messages::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,.08);
  border-radius: 2px;
}

/* Divisor */
.gb-divider {
  text-align: center;
  font-size: 9px;
  color: var(--gb-text-dim);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin: 8px 0;
  opacity: .5;
}

/* Filas de mensajes */
.gb-row {
  display: flex;
  align-items: flex-end;
  gap: 8px;
  animation: gb-msgin .2s cubic-bezier(.16,1,.3,1) both;
}

@keyframes gb-msgin {
  from { opacity: 0; transform: translateY(6px); }
  to   { opacity: 1; transform: translateY(0); }
}

.gb-row.user { flex-direction: row-reverse; }
.gb-row.bot  { margin-bottom: 2px; }

/* Avatar â€” minimalista, solo punto de color */
.gb-av {
  width: 24px; height: 24px;
  border-radius: 50%;
  background: var(--gb-surface2);
  border: 1.5px solid rgba(255,255,255,.08);
  display: flex; align-items: center; justify-content: center;
  font-size: 11px;
  flex-shrink: 0;
  margin-bottom: 2px;
}
.gb-av.bot  { border-color: rgba(200,240,0,.25); }
.gb-av.user { display: none; } /* como claude.ai â€” usuario sin avatar */

/* Burbujas â€” muy limpias */
.gb-bubble {
  max-width: 82%;
  padding: 10px 14px;
  border-radius: 14px;
  font-size: 13.5px;
  line-height: 1.6;
  letter-spacing: .01em;
}

.gb-bubble.bot {
  background: transparent;
  color: var(--gb-text);
  padding-left: 4px;
  border-radius: 0;
  max-width: 90%;
}

.gb-bubble.user {
  background: var(--gb-bubble-user);
  border: 1px solid var(--gb-bubble-user-border);
  border-radius: 14px 14px 4px 14px;
  color: var(--gb-text);
}

/* Quick replies â€” tarjetas redondeadas estilo claude.ai */
.gb-qr {
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding: 8px 0 4px 0;
  width: 100%;
}

/* Cuando son pocas opciones de navegaciÃ³n (menÃº principal) â€” columna completa */
.gb-qr-btn {
  font-size: 13px;
  font-weight: 500;
  padding: 11px 15px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.07);
  background: var(--gb-surface2);
  color: var(--gb-text);
  cursor: pointer;
  transition: all .15s;
  white-space: normal;
  letter-spacing: .01em;
  text-align: left;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  width: 100%;
}

/* Flecha a la derecha */
.gb-qr-btn::after {
  content: 'â€º';
  font-size: 16px;
  color: var(--gb-text-dim);
  flex-shrink: 0;
  transition: transform .15s, color .15s;
}

/* BotÃ³n de "volver" â€” mÃ¡s pequeÃ±o, sin flecha */
.gb-qr-btn[data-back="true"],
.gb-qr-btn:has-text("â†") {
  background: transparent;
  border-color: rgba(255,255,255,.05);
  color: var(--gb-text-dim);
  font-size: 11px;
  padding: 7px 12px;
  justify-content: flex-start;
}

.gb-qr-btn:hover {
  background: rgba(255,255,255,.06);
  border-color: rgba(200,240,0,.25);
  color: var(--gb-accent);
  transform: translateX(2px);
}

.gb-qr-btn:hover::after {
  transform: translateX(3px);
  color: var(--gb-accent);
}

/* Botones de "â† Volver" â€” estilo diferente, sin flecha */
.gb-qr-btn.gb-back-btn {
  background: transparent;
  border-color: rgba(255,255,255,.04);
  color: var(--gb-text-dim);
  font-size: 11px;
  padding: 7px 12px;
  max-width: fit-content;
}
.gb-qr-btn.gb-back-btn::after { display: none; }
.gb-qr-btn.gb-back-btn:hover {
  color: var(--gb-text);
  border-color: rgba(255,255,255,.1);
  transform: none;
}

/* Typing indicator */
.gb-typing {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 10px 4px;
  width: fit-content;
}

.gb-dot {
  width: 5px; height: 5px;
  border-radius: 50%;
  background: var(--gb-text-dim);
  animation: gb-bounce .9s ease-in-out infinite;
}
.gb-dot:nth-child(2) { animation-delay: .15s; }
.gb-dot:nth-child(3) { animation-delay: .30s; }

@keyframes gb-bounce {
  0%, 60%, 100% { transform: translateY(0); opacity: .3; }
  30%            { transform: translateY(-5px); opacity: 1; }
}

/* Highlights en texto */
#gb-messages .hl  { color: var(--gb-accent); font-weight: 600; }
#gb-messages .hl2 { color: var(--gb-accent2); font-weight: 600; }

/* â”€â”€ Formulario de escalaciÃ³n â”€â”€ */
.gb-form {
  background: rgba(255,255,255,.03);
  border: 1px solid rgba(200,240,0,.15);
  border-radius: 12px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 9px;
  animation: gb-msgin .25s cubic-bezier(.16,1,.3,1) both;
  margin: 4px 0;
}

.gb-form-title {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1.5px;
  color: var(--gb-accent);
  text-transform: uppercase;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(255,255,255,.06);
  margin-bottom: 2px;
}

.gb-input {
  width: 100%;
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(255,255,255,.09);
  border-radius: 8px;
  padding: 8px 12px;
  color: var(--gb-text);
  font-family: inherit;
  font-size: 13px;
  outline: none;
  transition: border-color .15s, box-shadow .15s;
}
.gb-input:focus {
  border-color: rgba(200,240,0,.4);
  box-shadow: 0 0 0 2px rgba(200,240,0,.08);
}
.gb-input::placeholder { color: var(--gb-text-dim); }

.gb-form select.gb-input {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%23484440' d='M1 1l5 5 5-5'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  padding-right: 28px;
}

.gb-form-submit {
  font-size: 12px;
  font-weight: 700;
  letter-spacing: .8px;
  padding: 9px 0;
  border-radius: 8px;
  border: none;
  background: var(--gb-accent);
  color: #0a0a0a;
  cursor: pointer;
  text-transform: uppercase;
  transition: all .15s;
  margin-top: 2px;
}
.gb-form-submit:hover {
  filter: brightness(1.08);
  box-shadow: var(--gb-glow);
}

.gb-form-note {
  font-size: 10px;
  color: var(--gb-text-dim);
  text-align: center;
  line-height: 1.5;
}

/* â”€â”€ Barra de input â€” claude.ai style â”€â”€ */
#gb-inputbar {
  border-top: 1px solid var(--gb-border);
  padding: 12px 14px;
  background: var(--gb-surface);
  display: flex;
  align-items: flex-end;
  gap: 8px;
  flex-shrink: 0;
}

/* Wrapper con borde animado al focus */
#gb-input-wrap {
  flex: 1;
  position: relative;
  border-radius: 12px;
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(255,255,255,.09);
  transition: border-color .2s, box-shadow .2s;
}

#gb-input-wrap:focus-within {
  border-color: rgba(200,240,0,.35);
  box-shadow: 0 0 0 3px rgba(200,240,0,.07);
}

#gb-input {
  width: 100%;
  background: transparent;
  border: none;
  border-radius: 12px;
  padding: 10px 14px;
  color: var(--gb-text);
  font-family: inherit;
  font-size: 13.5px;
  outline: none;
  resize: none;
  max-height: 96px;
  line-height: 1.5;
  display: block;
}
#gb-input::placeholder { color: var(--gb-text-dim); }

#gb-send {
  width: 36px; height: 36px;
  border-radius: 10px;
  border: none;
  background: var(--gb-accent);
  color: #0a0a0a;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  transition: all .15s;
  opacity: .9;
}
#gb-send:hover {
  opacity: 1;
  box-shadow: var(--gb-glow);
  transform: scale(1.05);
}
#gb-send:disabled { opacity: .25; cursor: default; transform: none; }

/* â”€â”€ Footer minimalista â”€â”€ */
#gb-footer {
  padding: 5px 14px 7px;
  background: var(--gb-surface);
  border-top: 1px solid var(--gb-border);
  text-align: center;
  font-size: 9px;
  color: var(--gb-text-dim);
  letter-spacing: .3px;
  opacity: .7;
}

#gb-footer span { color: rgba(200,240,0,.5); }

/* â”€â”€ Responsive mobile â”€â”€ */
@media (max-width: 480px) {
  #gb-widget {
    top: auto;
    bottom: 0;
    right: 0; left: 0;
    width: 100%;
    height: 70vh;
    border-radius: 12px 12px 0 0;
    transform: translateY(20px) scale(.98);
    max-height: calc(100vh - 60px);
  }
  #gb-widget.open {
    transform: translateY(0) scale(1);
  }
  #gb-fab-wrap {
    top: auto;
    bottom: 20px;
    transform: none;
    transition: opacity .25s, transform .25s;
  }
  #gb-fab-wrap.hidden {
    opacity: 0;
    pointer-events: none;
    transform: translateY(80px); /* se va hacia abajo en mobile */
  }
  #gb-fab {
    border-radius: 50%;
    width: 56px !important;
    height: 56px;
    min-height: 56px;
    padding: 8px !important;
    justify-content: center;
  }
  #gb-fab:hover {
    width: 56px !important;
    padding: 8px !important;
  }
  #gb-fab-label { display: none !important; }
  #gb-fab-img { width: 36px; height: 36px; }
}
</style>

<!-- Google Fonts para el widget -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@600;700&family=Exo+2:wght@400;500;600&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">

<!-- FAB lateral estilo Telcel -->
<div id="gb-fab-wrap">
  <button id="gb-fab" onclick="gbToggle()" aria-label="Abrir chat de soporte">
    <!-- 
      ILUSTRACIÃ“N: cambia el src por la ruta de tu .webp
      Ejemplo: src="assets/img/glitch-bot.webp"
    -->
    <img
      id="gb-fab-img"
      src="assets/img/glitch-bot.webp"
      alt="Asistente GlitchedBox"
      onerror="this.style.display='none'; document.getElementById('gb-fab-icon').style.display='block';"
    />
    <!-- Fallback SVG si no carga el webp -->
    <svg id="gb-fab-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M20 2H4C2.9 2 2 2.9 2 4v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
    </svg>
    <!-- Texto que aparece al hover -->
    <span id="gb-fab-label">Â¿En quÃ©<br>puedo ayudarte?</span>
    <!-- Ãcono cerrar (cuando estÃ¡ abierto) -->
    <svg id="gb-fab-close" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    </svg>
    <div id="gb-badge">1</div>
  </button>
</div>

<!-- Widget principal -->
<div id="gb-widget" role="dialog" aria-label="Chat de soporte GlitchedBox">

  <!-- Header â€” personaje centrado -->
  <div id="gb-header">
    <!-- Botones arriba a la derecha -->
    <div id="gb-header-actions">
      <button class="gb-hbtn" onclick="gbReset()" title="Reiniciar" aria-label="Reiniciar">â†º</button>
      <button class="gb-hbtn" onclick="gbToggle()" title="Cerrar" aria-label="Cerrar">âœ•</button>
    </div>
    <!--
      PERSONAJE: cambia src por la ruta de tu .webp
      Ej: src="assets/img/glitch-bot.webp"
    -->
    <img
      id="gb-header-char"
      src="assets/img/glitch-bot.webp"
      alt="Asistente GlitchedBox"
      onerror="this.style.display='none'; document.getElementById('gb-header-char-fallback').style.display='flex';"
    />
    <div id="gb-header-char-fallback">ğŸ²</div>

    <div class="gb-header-info">
      <div class="gb-header-name">Glitched<span>Box</span> Soporte</div>
      <div class="gb-status-row">
        <div class="gb-status-dot"></div>
        <div class="gb-header-sub">EN LÃNEA Â· RESPUESTA RÃPIDA</div>
      </div>
    </div>
  </div>

  <!-- Mensajes -->
  <div id="gb-messages" role="log" aria-live="polite"></div>

  <!-- Input -->
  <div id="gb-inputbar">
    <div id="gb-input-wrap">
      <textarea
        id="gb-input"
        rows="1"
        placeholder="EscrÃ­benos tu duda..."
        maxlength="500"
        aria-label="Mensaje"
      ></textarea>
    </div>
    <button id="gb-send" onclick="gbSend()" aria-label="Enviar mensaje">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
      </svg>
    </button>
  </div>

  <!-- Footer -->
  <div id="gb-footer">Soporte oficial Â· <span>glitchedbox.co</span></div>

</div>

<script>
(function() {
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIGURACIÃ“N â€” CAMBIAR AQUÃ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CFG = {
  emailSoporte:      'soporte@glitchedbox.co',       // PLACEHOLDER_EMAIL_SOPORTE
  emailPedidos:      'pedidos@glitchedbox.co',        // PLACEHOLDER_EMAIL_PEDIDOS
  emailCancelaciones:'cancelaciones@glitchedbox.co',  // PLACEHOLDER_EMAIL_CANCELACIONES
  emailContacto:     'contacto@glitchedbox.co',       // PLACEHOLDER_EMAIL_CONTACTO
  tiempoRespuesta:   '2â€“4 horas hÃ¡biles',
  horario:           'Lunes a viernes',
  // Clases que usa tu sitio para el tema claro (separadas por |)
  lightClasses:      'light|light-theme|tema-claro',
  lightAttr:         'light', // valor de data-theme para tema claro
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE DE CONOCIMIENTO â€” FAQ & FLUJOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const KB = {

  welcome: {
    text: 'Â¡Hola! ğŸ‘¾ Soy el asistente de <span class="hl">GlitchedBox</span>.\nÂ¿En quÃ© puedo ayudarte?',
    qr: ['ğŸ² Â¿QuÃ© es un Art Toy?', 'ğŸ“¦ Mi pedido', 'ğŸšš EnvÃ­os', 'ğŸ’³ Pagos', 'ğŸ”„ Devoluciones', 'ğŸ§‘â€ğŸ’» Hablar con un agente']
  },

  flujos: {

    /* â”€â”€ FAQ PRODUCTO â”€â”€ */
    'que es un art toy': {
      text: 'Los <span class="hl">art toys</span> son figuras de colecciÃ³n que combinan arte y diseÃ±o. No son simples juguetes: cada pieza es una obra con personalidad, historia y estilo propio.\n\nEn GlitchedBox cada personaje llegÃ³ a nuestro mundo por error a travÃ©s de un "glitch" âœ¨',
      qr: ['ğŸ§ª Â¿De quÃ© material son?', 'âœ¨ Â¿Son piezas Ãºnicas?', 'ğŸ¨ Â¿Hacen personalizados?', 'â† MenÃº principal']
    },

    'de que material son': {
      text: 'Nuestros art toys estÃ¡n hechos de <span class="hl">resina de alta calidad</span>. Algunos incorporan detalles pintados a mano.\n\nCada figura estÃ¡ cuidada hasta el Ãºltimo pÃ­xel para que luzca increÃ­ble tanto en vitrina como en tu feed ğŸ–¤',
      qr: ['âœ¨ Â¿Son piezas Ãºnicas?', 'â† MenÃº principal']
    },

    'son piezas unicas': {
      text: 'Â¡SÃ­! Algunas son parte de una <span class="hl">serie limitada</span>, otras tienen detalles pintados a mano o elementos Ãºnicos.\n\nNos gusta que cada pieza tenga ese algo especial que la haga irrepetible ğŸ²',
      qr: ['ğŸ¨ Â¿Hacen personalizados?', 'ğŸ“¦ Mi pedido', 'â† MenÃº principal']
    },

    'hacen personalizados': {
      text: 'Por ahora <span class="hl2">no ofrecemos art toys personalizados</span>.\n\nPero quiÃ©n sabe... si un dÃ­a abrimos esa opciÃ³n, lo anunciaremos a lo grande ğŸ‘€\n\nÂ¡SÃ­guenos en Instagram para enterarte primero!',
      qr: ['â† MenÃº principal']
    },

    /* â”€â”€ PEDIDOS â”€â”€ */
    'mi pedido': {
      text: 'Â¿QuÃ© necesitas saber sobre tu pedido?',
      qr: ['ğŸ“ Rastrear mi pedido', 'âŒ Cancelar pedido', 'ğŸ“¦ Pedido daÃ±ado o incorrecto', 'â† MenÃº principal']
    },

    'rastrear mi pedido': {
      text: 'Una vez procesado tu pedido, recibirÃ¡s un correo con el <span class="hl">nÃºmero de guÃ­a</span> y un enlace de seguimiento.\n\nSi ya tienes tu nÃºmero de guÃ­a, puedes rastrear tu paquete directamente en el sitio de la paqueterÃ­a.\n\nÂ¿No recibiste el correo de confirmaciÃ³n?',
      qr: ['ğŸ§‘â€ğŸ’» Contactar soporte', 'â† Mi pedido', 'â† MenÃº principal']
    },

    'cancelar pedido': {
      text: 'Las cancelaciones solo se permiten dentro de las <span class="hl">primeras 2 horas</span> despuÃ©s de realizar la compra, y siempre que el pedido no haya sido procesado o enviado.\n\nSi estÃ¡s dentro del plazo, escrÃ­benos de inmediato a:\n<span class="hl">cancelaciones@glitchedbox.co</span>',
      qr: ['ğŸ§‘â€ğŸ’» Contactar soporte', 'â† Mi pedido', 'â† MenÃº principal']
    },

    'pedido danado o incorrecto': {
      text: 'Lamentamos que tu figura haya llegado daÃ±ada o incorrecta ğŸ˜”\n\nSi aplica, podemos ofrecerte <span class="hl">reenvÃ­o o reemplazo sin costo</span>, segÃºn disponibilidad. Si no hay stock disponible, podremos ofrecer un <span class="hl">cupÃ³n o reembolso</span>.\n\nPara procesar tu caso necesitamos que nos reportes dentro de las primeras <span class="hl">48 horas</span> posteriores a la entrega:\n\nâ€¢ ğŸ“¸ Fotos del empaque exterior e interior\nâ€¢ ğŸ“¸ Fotos del daÃ±o o producto incorrecto\nâ€¢ ğŸ§¾ Tu nÃºmero de pedido\n\nCada caso se evalÃºa individualmente.',
      qr: ['ğŸ§‘â€ğŸ’» Abrir reporte de daÃ±o', 'â† Mi pedido', 'â† MenÃº principal']
    },

    /* â”€â”€ ENVÃOS â”€â”€ */
    'envios': {
      text: 'ğŸšš <span class="hl">EnvÃ­os GlitchedBox:</span>\n\nâ€¢ Enviamos a toda la <span class="hl">RepÃºblica Mexicana</span>\nâ€¢ Actualmente <span class="hl2">no realizamos envÃ­os internacionales</span>\nâ€¢ Tiempo de entrega: <span class="hl">3 a 7 dÃ­as hÃ¡biles</span>\nâ€¢ Pedidos procesados: lunes a viernes, 1â€“3 dÃ­as hÃ¡biles tras confirmar el pago\nâ€¢ <span class="hl">EnvÃ­o gratuito</span> en compras â‰¥ $2,500 MXN',
      qr: ['ğŸ“ Costo de envÃ­o', 'ğŸ“… Tiempos de entrega', 'âš ï¸ Zonas extendidas', 'ğŸ“¦ Paquete no entregado', 'â† MenÃº principal']
    },

    'costo de envio': {
      text: 'El costo de envÃ­o se calcula automÃ¡ticamente al finalizar tu compra, con base en el <span class="hl">peso, destino y tipo de servicio</span>.\n\nâœ… <span class="hl">EnvÃ­o gratis</span> en compras iguales o mayores a <span class="hl">$2,500 MXN</span>.\n\nâš ï¸ Este beneficio no aplica si tu direcciÃ³n estÃ¡ en zona extendida.',
      qr: ['âš ï¸ Zonas extendidas', 'â† EnvÃ­os', 'â† MenÃº principal']
    },

    'tiempos de entrega': {
      text: 'ğŸ“… <span class="hl">Tiempos estimados:</span>\n\nâ€¢ Entrega: <span class="hl">3 a 7 dÃ­as hÃ¡biles</span>\nâ€¢ Procesamiento: 1â€“3 dÃ­as hÃ¡biles (lunes a viernes)\nâ€¢ Productos bajo pedido: +3 a 4 dÃ­as hÃ¡biles adicionales\n\nUna vez enviado recibirÃ¡s tu nÃºmero de guÃ­a por correo.',
      qr: ['â† EnvÃ­os', 'â† MenÃº principal']
    },

    'zonas extendidas': {
      text: 'âš ï¸ Algunas direcciones en MÃ©xico pueden ser consideradas <span class="hl">zonas extendidas</span> por la paqueterÃ­a.\n\nEn esos casos el costo adicional (generalmente entre <span class="hl">$199 y $300 MXN</span>) corre por cuenta del cliente.\n\nSi tu pedido cae en zona extendida, te contactamos antes de enviarlo. El cargo no estÃ¡ incluido en el envÃ­o gratuito.',
      qr: ['â† EnvÃ­os', 'â† MenÃº principal']
    },

    'paquete no entregado': {
      text: 'Si tu paquete fue devuelto (direcciÃ³n incorrecta, ausencia, etc.) nos ponemos en contacto para reprogramar el envÃ­o.\n\nâš ï¸ El <span class="hl">nuevo costo de envÃ­o</span> deberÃ¡ ser cubierto por el cliente en ese caso.\n\nSi crees que hay un problema con tu entrega, contÃ¡ctanos.',
      qr: ['ğŸ§‘â€ğŸ’» Contactar soporte', 'â† EnvÃ­os', 'â† MenÃº principal']
    },

    /* â”€â”€ PAGOS â”€â”€ */
    'pagos': {
      text: 'ğŸ’³ <span class="hl">MÃ©todos de pago aceptados:</span>\n\nâ€¢ Tarjetas de crÃ©dito y dÃ©bito\nâ€¢ PayPal\nâ€¢ MercadoPago\n\nTodos los precios estÃ¡n en <span class="hl">pesos mexicanos (MXN)</span> e incluyen IVA.\n\nNo almacenamos los datos de tu tarjeta.',
      qr: ['â“ Pago rechazado', 'ğŸ§‘â€ğŸ’» Problema con mi pago', 'â† MenÃº principal']
    },

    'pago rechazado': {
      text: 'Los motivos mÃ¡s comunes de un pago rechazado son:\n\nâ€¢ Fondos insuficientes\nâ€¢ Tarjeta bloqueada por el banco\nâ€¢ Datos incorrectos (CVV, fecha de vencimiento)\nâ€¢ LÃ­mite de compras en lÃ­nea\n\nIntenta con otra tarjeta o cambia el mÃ©todo de pago. Si el problema persiste, contÃ¡ctanos.',
      qr: ['ğŸ§‘â€ğŸ’» Contactar soporte', 'â† Pagos', 'â† MenÃº principal']
    },

    /* â”€â”€ DEVOLUCIONES â”€â”€ */
    'devoluciones': {
      text: 'ğŸ”„ <span class="hl">PolÃ­tica de devoluciones:</span>\n\nTodas las ventas son <span class="hl">finales</span>. No aceptamos devoluciones ni cambios por cambio de opiniÃ³n, debido a la naturaleza limitada y coleccionable de nuestros productos.\n\n<span class="hl">ExcepciÃ³n:</span> Si tu figura llega daÃ±ada o recibiste un producto incorrecto, podemos ofrecer <span class="hl">reenvÃ­o, reemplazo, cupÃ³n o reembolso</span> segÃºn disponibilidad y evaluaciÃ³n del caso ğŸ“¦',
      qr: ['ğŸ“¦ Mi figura llegÃ³ daÃ±ada', 'âŒ Cancelar pedido', 'â† MenÃº principal']
    },

    'mi figura llego danada': {
      text: 'Lamentamos que tu figura haya llegado daÃ±ada ğŸ˜”\n\nSegÃºn disponibilidad, podemos ofrecerte <span class="hl">reenvÃ­o, reemplazo, cupÃ³n o reembolso</span>. Cada caso se evalÃºa individualmente.\n\nPara procesarlo necesitamos que nos reportes dentro de las primeras <span class="hl">48 horas</span> posteriores a la entrega:\n\nâ€¢ ğŸ“¸ Fotos del empaque exterior e interior\nâ€¢ ğŸ“¸ Fotos del daÃ±o\nâ€¢ ğŸ§¾ Tu nÃºmero de pedido',
      qr: ['ğŸ§‘â€ğŸ’» Abrir reporte de daÃ±o', 'â† MenÃº principal']
    },

    /* â”€â”€ PRIVACIDAD â”€â”€ */
    'privacidad': {
      text: 'ğŸ”’ <span class="hl">Tu privacidad importa:</span>\n\nGlitchedBox cumple con la <span class="hl">Ley Federal de ProtecciÃ³n de Datos Personales</span> (LFPDPPP).\n\nâ€¢ No compartimos ni vendemos tus datos\nâ€¢ Los pagos se procesan por plataformas seguras (no guardamos datos de tarjeta)\nâ€¢ Tienes derechos ARCO: Acceso, RectificaciÃ³n, CancelaciÃ³n y OposiciÃ³n\n\nConsulta la polÃ­tica completa en nuestro sitio.',
      qr: ['âš–ï¸ Propiedad intelectual', 'ğŸ” Edad mÃ­nima', 'â† MenÃº principal']
    },

    /* â”€â”€ PROPIEDAD INTELECTUAL â”€â”€ */
    'propiedad intelectual': {
      text: 'âš–ï¸ <span class="hl">Propiedad Intelectual:</span>\n\nTodos los diseÃ±os, personajes, imÃ¡genes y contenidos de GlitchedBox son de nuestra propiedad exclusiva y estÃ¡n protegidos por la <span class="hl">Ley Federal del Derecho de Autor</span>.\n\nLa marca GlitchedBox estÃ¡ registrada ante el <span class="hl">IMPI</span>.\n\nQueda <span class="hl2">estrictamente prohibido</span> copiar, reproducir, distribuir, revender o crear obras derivadas de nuestros personajes, diseÃ±os, imÃ¡genes o logotipos sin autorizaciÃ³n expresa y por escrito de GlitchedBox.',
      qr: ['â† MenÃº principal']
    },

    /* â”€â”€ EDAD MÃNIMA â”€â”€ */
    'edad minima': {
      text: 'ğŸ” <span class="hl">Edad mÃ­nima:</span>\n\nSolo pueden registrarse y realizar compras personas <span class="hl">mayores de 18 aÃ±os</span>.\n\nAl crear una cuenta o realizar una compra, el usuario declara bajo protesta de decir verdad que cumple con este requisito.',
      qr: ['â† MenÃº principal']
    },

    /* â”€â”€ ESCALACIÃ“N â”€â”€ */
    'abrir reporte de dano': { isEsc: true, escType: 'dano' },
    'contactar soporte':     { isEsc: true, escType: 'soporte' },
    'problema con mi pago':  { isEsc: true, escType: 'pago' },
    'hablar con un agente':  { isEsc: true, escType: 'agente' },
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAPA DE KEYWORDS â†’ FLUJO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const KW = [
  [/art.?toy|que.?es|figura|personaje|coleccion/i,       'que es un art toy'],
  [/material|resina|hecho|fabricad/i,                    'de que material son'],
  [/unic[oa]|limitad|especial|irrepetible/i,             'son piezas unicas'],
  [/personaliz|encarg|custom/i,                          'hacen personalizados'],
  [/rastrea|seguimiento|guia|tracking|donde.?esta/i,     'rastrear mi pedido'],
  [/cancel/i,                                            'cancelar pedido'],
  [/da[Ã±n]ad|roto|mal.?estado|incorrecto|equivocad|reenvio/i, 'pedido danado o incorrecto'],
  [/pedido|orden|compra|mi.?paquete/i,                   'mi pedido'],
  [/costo.?env[iÃ­]o|cu[aÃ¡]nto.?cobran|precio.?env[iÃ­]o/i,'costo de envio'],
  [/tiempo|tarda|d[iÃ­]as|cuando.?llega|demora/i,        'tiempos de entrega'],
  [/zona.?extendida|cargo.?extra/i,                      'zonas extendidas'],
  [/no.?entregad|devuelto|volvieron|regresaron/i,        'paquete no entregado'],
  [/env[iÃ­]o|entrega|paqueter[iÃ­]a|envian|envian|mandan/i,'envios'],
  [/pago.?rechazad|no.?pas[oÃ³]|declinado|fail/i,        'pago rechazado'],
  [/pago|cobro|pagar|tarjeta|paypal|mercado.?pago|precio/i,'pagos'],
  [/devoluci[oÃ³]n|cambio|regresar|reembolso/i,          'devoluciones'],
  [/da[Ã±n]ad|roto|llego.?mal/i,                         'mi figura llego danada'],
  [/privacidad|datos|arco|cookies|gdpr/i,                'privacidad'],
  [/propiedad.?intelectual|copyright|copiar|diseÃ±o|reproduc|impi|marca.?registrada/i, 'propiedad intelectual'],
  [/edad.?m[iÃ­]nima|18.?a[Ã±n]os|menor.?edad|mayor.?de.?edad/i, 'edad minima'],
  [/agente|humano|persona|asesor|soporte/i,              'hablar con un agente'],
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESTADO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const msgsEl  = document.getElementById('gb-messages');
const inputEl = document.getElementById('gb-input');
const fabEl   = document.getElementById('gb-fab');
const badgeEl = document.getElementById('gb-badge');
const widgetEl= document.getElementById('gb-widget');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETECCIÃ“N DE TEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function detectarTema() {
  const html   = document.documentElement;
  const body   = document.body;
  const clases = CFG.lightClasses.split('|');

  const esClaro =
    html.getAttribute('data-theme') === CFG.lightAttr ||
    body.getAttribute('data-theme') === CFG.lightAttr ||
    clases.some(c => html.classList.contains(c) || body.classList.contains(c));

  if (esClaro) {
    widgetEl.classList.add('gb-light');
  } else {
    widgetEl.classList.remove('gb-light');
  }
}

// Observar cambios de tema en tiempo real
new MutationObserver(detectarTema).observe(document.documentElement, {
  attributes: true, attributeFilter: ['class', 'data-theme']
});
new MutationObserver(detectarTema).observe(document.body, {
  attributes: true, attributeFilter: ['class', 'data-theme']
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOGGLE WIDGET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function gbToggle() {
  const abierto = widgetEl.classList.toggle('open');
  fabEl.classList.toggle('open', abierto);

  // Ocultar/mostrar el botÃ³n lateral segÃºn estado del chat
  const fabWrap = document.getElementById('gb-fab-wrap');
  if (abierto) {
    fabWrap.classList.add('hidden');
    badgeEl.classList.add('hidden');
    inputEl.focus();
    detectarTema();
  } else {
    // PequeÃ±o delay para que la animaciÃ³n de cierre del chat
    // termine antes de que aparezca el botÃ³n
    setTimeout(() => fabWrap.classList.remove('hidden'), 150);
  }
}
window.gbToggle = gbToggle;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS DOM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function scrollFondo() {
  setTimeout(() => { msgsEl.scrollTop = msgsEl.scrollHeight; }, 60);
}

function addBurbuja(html, lado = 'bot') {
  const row = document.createElement('div');
  row.className = `gb-row ${lado}`;

  const av = document.createElement('div');
  av.className = `gb-av ${lado === 'bot' ? 'bot' : 'user'}`;
  av.textContent = lado === 'bot' ? 'ğŸ²' : 'ğŸ‘¤';

  const bub = document.createElement('div');
  bub.className = `gb-bubble ${lado}`;
  bub.innerHTML = html.replace(/\n/g, '<br>');

  if (lado === 'bot') { row.appendChild(av); row.appendChild(bub); }
  else                { row.appendChild(bub); row.appendChild(av); }

  msgsEl.appendChild(row);
  scrollFondo();
  return bub;
}

function addQR(replies) {
  const wrap = document.createElement('div');
  wrap.className = 'gb-qr';
  replies.forEach(r => {
    const btn = document.createElement('button');
    // Botones de "volver" (empiezan con â†) â€” estilo diferente
    const isBack = r.startsWith('â†') || r.toLowerCase().includes('menÃº principal');
    btn.className = 'gb-qr-btn' + (isBack ? ' gb-back-btn' : '');
    btn.textContent = r;
    btn.onclick = () => handleQR(r);
    wrap.appendChild(btn);
  });
  msgsEl.appendChild(wrap);
  scrollFondo();
}

function showTyping() {
  const row = document.createElement('div');
  row.className = 'gb-row bot'; row.id = 'gb-typing';
  const av = document.createElement('div');
  av.className = 'gb-av bot'; av.textContent = 'ğŸ²';
  const ind = document.createElement('div');
  ind.className = 'gb-typing';
  ind.innerHTML = '<div class="gb-dot"></div><div class="gb-dot"></div><div class="gb-dot"></div>';
  row.appendChild(av); row.appendChild(ind);
  msgsEl.appendChild(row);
  scrollFondo();
}

function hideTyping() {
  const t = document.getElementById('gb-typing');
  if (t) t.remove();
}

function clearQR() {
  document.querySelectorAll('.gb-qr').forEach(e => e.remove());
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMULARIO DE ESCALACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showForm(tipo) {
  const titulos = {
    dano:    'ğŸ“¸ REPORTE DE PRODUCTO DAÃ‘ADO',
    soporte: 'ğŸ§‘â€ğŸ’» CONTACTAR CON SOPORTE',
    pago:    'ğŸ’³ PROBLEMA CON MI PAGO',
    agente:  'ğŸ§‘â€ğŸ’» HABLAR CON UN AGENTE',
  };
  const emailDestino = {
    dano:    CFG.emailPedidos,
    soporte: CFG.emailSoporte,
    pago:    CFG.emailSoporte,
    agente:  CFG.emailSoporte,
  };

  const form = document.createElement('div');
  form.className = 'gb-form';
  form.id = 'gb-esc-form';

  const necesitaFotos = tipo === 'dano';

  form.innerHTML = `
    <div class="gb-form-title">${titulos[tipo] || 'ğŸ§‘â€ğŸ’» CONTACTAR SOPORTE'}</div>
    <input class="gb-input" id="gbf-nombre" type="text"  placeholder="Tu nombre completo *" required />
    <input class="gb-input" id="gbf-email"  type="email" placeholder="Tu correo electrÃ³nico *" required />
    <input class="gb-input" id="gbf-orden"  type="text"  placeholder="NÃºmero de pedido (ej: #GB-12345)" />
    <select class="gb-input" id="gbf-tipo">
      <option value="">Tipo de problema...</option>
      <option value="pedido_danado">Pedido daÃ±ado / incorrecto</option>
      <option value="no_llego">Mi pedido no llegÃ³</option>
      <option value="pago">Problema con el pago</option>
      <option value="cancelacion">CancelaciÃ³n de pedido</option>
      <option value="otro">Otro</option>
    </select>
    <textarea class="gb-input" id="gbf-desc" rows="2" placeholder="DescrÃ­benos tu problema brevemente..."></textarea>
    ${necesitaFotos ? `<p class="gb-form-note">ğŸ“¸ Por favor envÃ­a las fotos a <strong>${emailDestino[tipo]}</strong> junto con tu nÃºmero de pedido para agilizar el proceso.</p>` : ''}
    <button class="gb-form-submit" onclick="submitForm('${tipo}','${emailDestino[tipo]}')">ENVIAR SOLICITUD â†’</button>
    <p class="gb-form-note">Respondemos en ${CFG.tiempoRespuesta} Â· ${CFG.horario}</p>
  `;

  msgsEl.appendChild(form);
  scrollFondo();
}

function submitForm(tipo, email) {
  const nombre = document.getElementById('gbf-nombre')?.value.trim();
  const correo = document.getElementById('gbf-email')?.value.trim();
  const orden  = document.getElementById('gbf-orden')?.value.trim();
  const desc   = document.getElementById('gbf-desc')?.value.trim();

  if (!nombre || !correo) {
    const n = document.getElementById('gbf-nombre');
    const e = document.getElementById('gbf-email');
    if (!nombre) n.style.borderColor = 'var(--gb-accent2)';
    if (!correo) e.style.borderColor = 'var(--gb-accent2)';
    return;
  }

  const ticketId = 'GB-' + Math.floor(Math.random() * 90000 + 10000);
  document.getElementById('gb-esc-form')?.remove();

  showTyping();
  setTimeout(() => {
    hideTyping();
    addBurbuja(
      `âœ… Â¡Recibido, <span class="hl">${nombre}</span>!\n\n` +
      `Tu nÃºmero de ticket: <span class="hl">${ticketId}</span>\n\n` +
      `Te responderemos en <span class="hl">${CFG.tiempoRespuesta}</span> al correo <span class="hl">${correo}</span>\n\n` +
      (tipo === 'dano' ? `Recuerda enviarnos las fotos a <span class="hl">${email}</span> con tu nÃºmero de ticket. Evaluaremos tu caso y te ofreceremos la mejor soluciÃ³n segÃºn disponibilidad ğŸ“¸` : `Si necesitas atenciÃ³n urgente escrÃ­benos a <span class="hl">${email}</span>`)
    );
    addQR(['ğŸ  MenÃº principal', 'â“ Otra pregunta']);
  }, 1200);
}
window.submitForm = submitForm;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOTOR DE FLUJOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function ejecutarFlujo(key) {
  const flujo = KB.flujos[key];
  if (!flujo) return false;

  if (flujo.isEsc) {
    showTyping();
    setTimeout(() => {
      hideTyping();
      const prefijos = {
        dano:    'Para reportar tu producto daÃ±ado o incorrecto, completa el siguiente formulario. Lo evaluaremos y te contactaremos con la soluciÃ³n:',
        soporte: 'Con gusto te conectamos con nuestro equipo. Completa el formulario:',
        pago:    'Vamos a revisar el problema con tu pago. Completa el formulario:',
        agente:  'Te conectamos con un agente. Completa el formulario:',
      };
      addBurbuja(prefijos[flujo.escType] || 'Completa el formulario para continuar:');
      showForm(flujo.escType);
    }, 800);
    return true;
  }

  showTyping();
  setTimeout(() => {
    hideTyping();
    addBurbuja(flujo.text);
    if (flujo.qr?.length) addQR(flujo.qr);
  }, 800);
  return true;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MANEJO DE QUICK REPLIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function handleQR(texto) {
  clearQR();
  document.getElementById('gb-esc-form')?.remove();

  const clean = texto.toLowerCase()
    .replace(/^[^\w\sÃ¡Ã©Ã­Ã³ÃºÃ¼Ã±]*\s*/u, '')
    .replace(/[Â¿?Â¡!]/g, '')
    .trim();

  if (clean === 'menÃº principal' || clean === 'â† menÃº principal') {
    addBurbuja(KB.welcome.text);
    addQR(KB.welcome.qr);
    return;
  }

  // Mensaje del usuario visible
  addBurbuja(texto, 'user');

  // Buscar flujo exacto primero
  const keyClean = clean
    .replace(/^â† /, '')
    .replace(/[Â¿?Â¡!]/g, '')
    .trim()
    .toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g, '');

  // Mapa rÃ¡pido de etiquetas comunes de botones
  const BTNMAP = {
    'que es un art toy':          'que es un art toy',
    'de que material son':        'de que material son',
    'hacen personalizados':       'hacen personalizados',
    'son piezas unicas':          'son piezas unicas',
    'mi pedido':                  'mi pedido',
    'rastrear mi pedido':         'rastrear mi pedido',
    'cancelar pedido':            'cancelar pedido',
    'pedido danado o incorrecto': 'pedido danado o incorrecto',
    'envios':                     'envios',
    'costo de envio':             'costo de envio',
    'tiempos de entrega':         'tiempos de entrega',
    'zonas extendidas':           'zonas extendidas',
    'paquete no entregado':       'paquete no entregado',
    'pagos':                      'pagos',
    'pago rechazado':             'pago rechazado',
    'devoluciones':               'devoluciones',
    'mi figura llego danada':     'mi figura llego danada',
    'privacidad':                 'privacidad',
    'propiedad intelectual':      'propiedad intelectual',
    'edad minima':                'edad minima',
    'abrir reporte de dano':      'abrir reporte de dano',
    'contactar soporte':          'contactar soporte',
    'problema con mi pago':       'problema con mi pago',
    'hablar con un agente':       'hablar con un agente',
  };

  // Normalizar botÃ³n a key de KB
  const normalized = keyClean.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
  const found = Object.keys(BTNMAP).find(k =>
    normalized.includes(k) || k.includes(normalized.substring(0, 10))
  );

  if (found && ejecutarFlujo(BTNMAP[found])) return;

  // Fallback por keywords
  const kwMatch = KW.find(([rx]) => rx.test(texto));
  if (kwMatch && ejecutarFlujo(kwMatch[1])) return;

  fallback(texto);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEXTO LIBRE DEL USUARIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function gbSend() {
  const texto = inputEl.value.trim();
  if (!texto) return;

  clearQR();
  document.getElementById('gb-esc-form')?.remove();
  addBurbuja(texto, 'user');
  inputEl.value = '';
  autoResize();

  const kwMatch = KW.find(([rx]) => rx.test(texto));
  if (kwMatch && ejecutarFlujo(kwMatch[1])) return;

  fallback(texto);
}
window.gbSend = gbSend;

function fallback(texto) {
  showTyping();
  setTimeout(() => {
    hideTyping();
    addBurbuja(
      `Hmm, no encontrÃ© una respuesta automÃ¡tica para "<span class="hl">${texto.substring(0,40)}${texto.length>40?'...':''}</span>".\n\nÂ¿Te ayudo con algo de esto?`
    );
    addQR(['ğŸ“¦ Mi pedido', 'ğŸšš EnvÃ­os', 'ğŸ’³ Pagos', 'ğŸ”„ Devoluciones', 'ğŸ§‘â€ğŸ’» Hablar con un agente']);
  }, 900);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function gbReset() {
  msgsEl.innerHTML = '';
  const div = document.createElement('div');
  div.className = 'gb-divider';
  div.textContent = 'â€” NUEVA CONVERSACIÃ“N â€”';
  msgsEl.appendChild(div);
  initWelcome();
}
window.gbReset = gbReset;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTO-RESIZE TEXTAREA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function autoResize() {
  inputEl.style.height = 'auto';
  inputEl.style.height = Math.min(inputEl.scrollHeight, 96) + 'px';
}

inputEl.addEventListener('input', autoResize);
inputEl.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    gbSend();
  }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INICIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initWelcome() {
  showTyping();
  setTimeout(() => {
    hideTyping();
    addBurbuja(KB.welcome.text);
    addQR(KB.welcome.qr);
  }, 700);
}

// Inicializar al cargar
detectarTema();
initWelcome();

})(); // fin IIFE
</script>   
</body>
</html>
